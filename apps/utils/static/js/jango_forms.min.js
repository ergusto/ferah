(function(e,c,b,g){var d="jangoForm",f={redirectURL:"",redirectOnSuccess:false,resetOnSuccess:true,formErrorElement:e("#form_errors"),formErrorClass:"form-error",fieldErrorClass:"error",handlebarsTemplate:null,prependTo:null,appendTo:null,idNamingConvention:"#id_"};function a(i,h){this.form=e(i);this.settings=h;this._defaults=f;this._name=d;this.init()}a.prototype={init:function(){this.primeEventListeners()},primeEventListeners:function(){var h=this;this.form.submit(function(i){i.preventDefault();if(h.form.data("disabled")){return}h.toggleFormDisable();h.sendAjaxRequest(this)})},toggleFormDisable:function(){if(this.form.data("disabled")){this.form.data("disabled",false)}else{this.form.data("disabled",true)}},sendAjaxRequest:function(j){var i=this;var h=e(j);this.clearFormErrors(h);e.ajax({type:h.attr("method"),url:h.attr("action"),contentType:"application/x-www-form-urlencoded;charset=utf-8",data:h.serialize(),success:function(k){i.parseAjaxSuccessResponse(k)},error:function(k,m,l){i.parseAjaxErrorResponse(k)}})},clearFormErrors:function(j){var h=this.settings.formErrorElement;var i="."+this.settings.fieldErrorClass;h.css("display","none");h.empty();e(i,j).remove()},parseAjaxSuccessResponse:function(h){if(this.settings.redirectOnSuccess){this.initiateRedirect(h)}else{this.toggleFormDisable();if(this.settings.resetOnSuccess){this.form.trigger("reset")}if(this.settings.handlebarsTemplate){this.renderHandlebars(h)}else{console.log("Please either provide a redirectURL and set redirect to true, or provide a handlebars template in the constructor.");return}}},initiateRedirect:function(h){if(this.settings.redirectURL){c.location.replace(this.settings.redirectURL)}else{if(h.redirect_url){c.location.replace(h.redirect_url)}else{if(h.get_absolute_url){c.location.replace(h.get_absolute_url)}else{console.log("No url to redirect to. Please provide one in the constructor.");return}}}},renderHandlebars:function(h){var j=h;var l=this.settings.handlebarsTemplate.html();var k=Handlebars.compile(l);if(this.settings.prependTo&&this.settings.appendTo){console.log("Please supply an element to either prependTo, or appendTo, but not both.");return}else{if(this.settings.prependTo){var m=this.settings.prependTo;m.prepend(k(j))}else{if(this.settings.appendTo){var i=this.settings.appendTo;i.append(k(j))}}}},parseAjaxErrorResponse:function(i){var h=this;var j=e.parseJSON(i.responseText);this.toggleFormDisable();e.each(j,function(k,l){if(k==="__all__"){h.applyFormError(l)}else{h.applyFieldError(k,l)}})},applyFormError:function(i){var h=this.settings.formErrorElement,j=e("<span />").addClass(this.settings.formErrorClass).text(i[0]);h.css("display","block");h.append(j)},applyFieldError:function(i,j){var h=e(this.settings.idNamingConvention+i),k=e("<span />").addClass(this.settings.fieldErrorClass).text(j[0]);k.insertAfter(h)}};e.fn[d]=function(h){return this.each(function(){var i=e.extend({},f,h);if(!e.data(this,"plugin_"+d)){e.data(this,"plugin_"+d,new a(this,i))}},h)}})(jQuery,window,document);